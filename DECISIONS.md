2025-08-16: Simplified character enrichment spec to exclude importance tiers and rich provenance (bios, backstory). Minimal fields retained: canonical_name, optional display_name, aliases. Updated franchise enrichment doc & sample manifest accordingly per user preference for lean DB.
# Decisions

2025-08-15: Created separate repo (STL-manager) to isolate code/planning from blog and avoid large binary history.
2025-08-15: Phase 0 limited to read-only inventory of already extracted files; archives untouched.
2025-08-15: Adopted graded NSFW metadata (nsfw_level + exposure + act tags) to enable nuanced filtering beyond binary content_flag; detailed fields deferred until Phase 2 to avoid premature manual burden.
2025-08-15: Added cross-system lineage/race taxonomy (lineage_primary + subrace + aliases) and tabletop_role / pc_candidate_flag to support filtering (e.g., all elves, DnD adventurer humans vs Warhammer humans) without overfitting early; most advanced facets deferred to P2.
2025-08-15: Refined lineage model to two-tier (lineage_family vs lineage_primary) so distinct elf subtypes (high_elf, wood_elf, dark_elf, drow) remain separate while enabling broad family filters; lineage_primary postponed to P2.
2025-08-15: Expanded lineage_primary examples across all lineage families (not only elves) to ensure specificity (e.g., mountain_dwarf vs chaos_dwarf, ork vs orruk, vampire vs lich) and documented non-exhaustive controlled vocabulary strategy.
2025-08-15: Introduced versioned token normalization map (`tokenmap.md`) covering designer aliases, lineage tokens, faction/family mappings, NSFW cues, variant axis indicators, and confidence / warning rule ordering; baseline declared as token_map_version 1 for Phase 1 rollout.
2025-08-15: Expanded Warhammer 40K & Age of Sigmar faction coverage in token map (added full mainline armies & common aliases, corrected 'adeptus_astartes' typo) and bumped token_map_version to 2 to preserve reproducibility.
2025-08-15: Drafted normalization flow specification (`NormalizationFlow.md`) to formalize deterministic ordering, conflict handling, confidence scoring, and re-run strategy separate from vocabulary content.
2025-08-15: Added addon / upgrade fields (expanded part_pack_type; new addon_type, requires_base_model, compatibility_scope, compatible_units, compatible_factions, multi_faction_flag, attachment_points, replaces_parts, additive_only_flag, clothing_variant_flag, magnet_ready_flag) to support weapon/clothing/conversion packs in Phase 2.
2025-08-15: Introduced sculpt style metadata (style_primary P1; style_secondary_tags P2) with initial vocab (heroic, realistic, semi_realistic, stylized, anime, chibi, grimdark, low_poly, toon, other; secondary: gritty, painterly, gothic, biomechanical, baroque, organic, ornate, minimalist) to enable aesthetic filtering early; primary chosen for robust broad buckets, secondary deferred for optional refinement.
2025-08-15: Refined style taxonomy: limited style_primary strictly to anatomical proportion axis (realistic, heroic, anime) and renamed style_secondary_tags to style_aesthetic_tags for orthogonal aesthetic descriptors (grimdark, baroque, gothic, biomechanical, ornate, etc.) separating anatomy from surface/art direction.
2025-08-15: Added style_primary_confidence (certain/probable/guess) acknowledging explicit 'heroic' tokens uncommon; default inference workflow sets guess then escalates via manual review.
2025-08-15: Policy: Do not auto-assign style_primary when anime vs realistic is ambiguous; leave null unless explicit tokens or manual confirmationâ€”prevents mislabeling near-realistic anime-inspired sculpts.
2025-08-15: Added `scripts/quick_scan.py` (read-only token frequency scan) to surface overlooked vocab candidates before formalizing token map v3; stdout only, no persistence.
2025-08-15: Enhanced quick_scan with `--json-out` structured report (scanned_files, distinct_tokens, top_unknown_tokens, scale tokens, numeric tokens, suggestions) to enable diffing across runs.
2025-08-15: Added double-click batch wrapper `run_quick_scan.bat` and default behaviors (root=script dir, json_out=quick_scan_report.json) for frictionless ad-hoc scans.
2025-08-15: Increased quick_scan default file limit from 50k to 100k to cover larger collections without needing a flag override.
2025-08-15: Raised quick_scan default unknown token slice from 40 to 100 to broaden early vocab discovery without multiple reruns.
2025-08-15: Updated quick_scan to tokenize directory names (previously only file stems) to capture part/pose/category indicators often stored only in folder hierarchy; added --skip-dirs flag for backwards-compat and added scanned_directories field to JSON report.
2025-08-15: Bumped token_map_version to 3 adding new designers (tinylegend, azerama), lineage expansions (ratfolk, kobold), future seed (minotaur), and documented planned tabletop-specific optional fields (equipment_type, pose_index, base_size_mm, base_shape, unit_role) gated on future tabletop intent detection to avoid noise for non-tabletop assets.
2025-08-15: Added dynamic vocab loading to quick_scan via --tokenmap parsing minimal sections of tokenmap.md (designers, lineage family_map, faction aliases, stopwords) to eliminate manual duplication and keep exploratory scan aligned with current map version; preserves embedded defaults as fallback.
2025-08-15: Added --ignore-file (suppress specified tokens from unknown list) and --emit-known-summary (domain counts + JSON fields ignored_tokens, domain_summary) to quick_scan to focus on genuinely new vocabulary amid high-frequency but uninteresting tokens.
2025-08-15: quick_scan now auto-loads `ignored_tokens.txt` (if present beside script) when --ignore-file is not provided, reducing friction for repeated exploratory scans.
2025-08-15: Added --include-archives flag to quick_scan to optionally tokenize archive filenames (zip/rar/7z/cbz/cbr) without extraction, capturing collection metadata hints embedded only in archive names; JSON now includes scanned_archives.
2025-08-15: Added --archive-sample flag to quick_scan to surface low-frequency archive-only tokens not present in main unknown slice for early detection of novel designers or content tags.
2025-08-15: Enhanced tokenizer normalization: strips wrapper punctuation (),[]{}+ trims leading '@', removes trailing '.stl' residue inside tokens (e.g., 'unsupported.stl' -> 'unsupported') reducing noise in unknown list.
2025-08-15: Added singular 'part' to variant axis vocabulary to catch archives using 'part' instead of 'parts' for segmentation indicators.
2025-08-15: Bumped token_map_version to 4 adding numerous newly confirmed designers (hybris_studio, pikky_prints, warsteel_miniatures, momoji, moonfigures, three_dmoonn, funservicestl, miyo_studio, megha, kuton, zahen_studio, chuya_factory, kuru_figure, nomnom, nympha3d, moxomor, mezgike, abe3d, ca3d, jigglystix, torrida, skarix, xo3d) plus consolidation of oxo3d spellings; extended ratfolk lineage synonyms (ratkin, ratmen); added futa to strong nsfw cues; classified 'uncut' as merged segmentation alias.
2025-08-15: Bumped token_map_version to 5 incorporating extended designer list from user-provided roster (rubim, pink_studio, dinamuuu3d, torrida_minis, zf3d, gsculpt_art, aliance, messias3d_figure, obstetrician_m_booth, vx_labs, cw_studio/chickenwar, es_monster, gm3d, kangyong, manilovefigures, peachfigure, officer_rhu, exclusive3dprinting, rushzilla, francis_quez) and normalized multi-word / punctuation variants.
2025-08-15: Bumped token_map_version to 6 adding short alias 'esm' for es_monster to capture abbreviated archive naming.
2025-08-15: Bumped token_map_version to 7 adding large bulk designer alias ingestion from extended user list (artifex3d, atelier_ryza, bam_broken_anvil_monthly, bella_nacht_miniatures, brunoart3d, bulkamancer, carlos_eduardo, chagarin, alvaro_stuardo, cyber_forge, titan_forge, gambody, dmg_minis, dodomo_studio, dt_minis, eightlegsminiatures, ella_art, epic_minis, ritual_casting, figuremaster, gible_art, gilmore_studio, gr8_studio, greytide_studio, h3ll_creator, hobbyhouse, il_paddyy, kigglystix, jojoba, double_vertex, kitno, kugo_figures, leonardo_murilo, lionrealm_studio, loot_studios, lost_kingdom, lucas_perez_studio, mads_minis, marta_punkgirl, mcm3d, mythreal_games, nebula4444, neko_figurines, nerikson, night_sky_miniatures, nr3ds, one_page_rules, psmini, qb_works, raw_ronin_arts_workshop, red_clay, rks3d, sakosigue_art, saltsculpt, serik_collection, shinobu_sculpt, sin3dstudio, siryll_art, soarez3d, stephanov_sculpts, tc_random_collectibles, tenshi_figures, the_printing_lord, the_beholder_miniatures, toon_studios, trick_or_treat, twin_goddess_miniatures, ukupalua, union_creative, xhunart, zez_studios, gaz_minis, three_dartguy, box_studio, nutshell_atelier) with normalized spacing/punctuation; duplicates consolidated.
2025-08-15: Bumped token_map_version to 8 externalizing large designers section into `designers_tokenmap.md` to reduce churn in core map and enable independent versioning; tokenmap now references external file conceptually.
2025-08-15: Added external designers loading support in quick_scan (`--designers-file` with default fallback designers_tokenmap.md) and optional `--strip-designer-suffixes` heuristic to collapse variants like *studio, *minis, *prints after alias recognition.
2025-08-15: Bumped token_map_version to 9 removing residual inline designer alias block lines left over after externalization; replaced with explicit sentinel (`designers: external_reference`) ensuring single source of truth is `designers_tokenmap.md`.
2025-08-16: Added new metadata fields for broad asset categorization: asset_category (P1), and planned P2 fields terrain_subtype, vehicle_type, vehicle_era, base_theme. Rationale: collection includes substantial non-character assets (terrain, foliage, vehicles, decorative base sets); early coarse category improves filtering and prevents misapplying character-centric heuristics (e.g., pc_candidate_flag) to terrain/vehicle records. Controlled vocab seeds added to `MetadataFields.md`; conservative default = miniature when ambiguity.
2025-08-16: Bumped token_map_version to 10 adding preliminary (inactive in P1) `codex_units` seed list for Warhammer 40K Space Marine core/primaris units (intercessors, assault/heavy variants, tactical, aggressors, terminators, bladeguard, eradicators, hellblasters, infernus, inceptors, sternguard, desolation). Marked with activation gating for future Phase 2; rationale: capture high-frequency unit tokens early for consistent future normalization while avoiding current misclassification risk.
2025-08-16: Bumped token_map_version to 11 externalizing `codex_units` into dedicated files (`codex_units_w40k.md`, `codex_units_aos.md`, `codex_units_oldworld.md`) and replacing inline block with sentinel `codex_units: external_reference`. Added multi-faction initial coverage (40K core infantry/vehicle samples across Space Marines, Necrons, Tyranids, Orks, Astra Militarum, Adeptus Mechanicus, Chaos Space Marines; AoS core for Stormcast, Cities, Fyreslayers, Kharadron, Seraphon, Sylvaneth, Ossiarch Bonereapers, Nighthaunt, Chaos pantheon samples, Gloomspite, Orruk Warclans, Ogor Mawtribes, Skaven, Sons of Behemat; Old World early Bretonnia, Empire, Dwarfs, Orcs & Goblins, Tomb Kings, Skaven). Rationale: reduce core file churn, enforce contextual activation, enable iterative safe expansion.
2025-08-16: Added `codex_units_heresy.md` (Version 1) introducing Warhammer 30K / Horus Heresy generic Legiones Astartes unit & vehicle vocabulary (tactical, support, breacher, destroyer, recon, veteran, terminator variants, dreadnought chassis, core tanks, flyers) under Phase 2 gating. No token_map_version bump (sentinel unchanged); rationale: extend external modular tabletop coverage while keeping core map lean.
2025-08-16: Repository restructure: created `docs/` (moved planning/spec files) and `vocab/` (moved tokenmap + designers + codex unit vocab files). Updated `quick_scan.py` to auto-detect relocated vocab paths (prefers vocab/ then root fallback). Rationale: reduce root clutter, clarify domain separation (code vs vocab vs documentation), enable future loader globbing of vocab/*.md.
2025-08-16: Completed migration of all vocab (tokenmap, designers, codex units w40k/aos/oldworld/heresy) and planning/spec files into `vocab/` and `docs/`. Root duplicates could not be deleted via automated patch tool in this environment; replaced with short stub pointers where feasible. Action required: manually delete remaining root duplicates (`API_SPEC.md`, `MetadataFields.md`, `NormalizationFlow.md`, `PLANNING.md`, `DesiredFeatures.md`, `tokenmap.md`, `designers_tokenmap.md`, `codex_units_*.md`) once verified in `docs/` / `vocab/` to prevent accidental edits. Quick scan now warns if falling back to legacy root files.
2025-08-16: Added multi-unit proxy support concept: a single physical model (variant) may map to multiple codex units when weapon/loadout choices differentiate roles (e.g., Warhammer 40K Space Marine body that can be built as tactical, devastator, or sternguard depending on arm/weapon bits). Introduced fields `multi_unit_proxy_flag` (boolean) in `MetadataFields.md` and clarified that many-to-many table `variant_unit` can contain multiple rows per variant with distinct `unit_id` and potentially differing `proxy_type` (e.g., direct_clone for one loadout vs counts_as for another). Rationale: avoid forcing artificial splitting of a physical STL pack, preserve accurate search/filter semantics (show all legitimate unit uses), and enable later UI to show per-loadout validation status. No token_map_version bump (schema-level planning only, no normalization rule changes yet).
2025-08-16: Expanded proxy/loadout modeling: Added granular component & loadout schema concepts (`component`, `unit_loadout`, `variant_component_supply`, `variant_unit_proxy`) plus variant fields (`supported_loadout_codes`, virtual `loadout_coverage_summary`). API spec extended with endpoints `/variants/{id}/proxy-candidates`, `/variants/{id}/loadout-coverage`, and proxy assertion create/delete. Rationale: enable UI flow where user selects a variant and views all legitimate unit proxy targets with per-loadout completeness (complete/partial/missing), supporting scenarios of (a) multi-loadout packs from single creator (e.g., Titan Forge) and (b) mixed cross-designer kitbashing (scans + third-party weapons). Still Phase 2 planning; normalization rules and vocab for component/loadout codes to be introduced later with gating. No token_map_version bump (no rule changes yet).
2025-08-16: Added explicit component compatibility tagging model: new variant fields (`compatible_model_group_ids`, `compatible_variant_ids`, virtual `compatibility_assertions`) and relationship table `variant_component_compatibility` with fit_type (exact|near|generic|uncertain) + confidence tri-state. API endpoints `/variants/{id}/component-compatibility` (GET/POST/DELETE). Goal: allow equipment/loadout parts to declare which base model groups or specific shells they fit, supporting Titan Forge style internal ecosystem and cross-designer kitbash mapping (e.g., third-party plasma gun arms onto scanned official bodies). Chosen dual target (group or variant) for robustness during early grouping evolution. Still planning stage; no normalization yet; no token_map_version bump.
2025-08-16: Introduced franchise enrichment workflow spec (`FranchiseEnrichment.md`) and manifest directory `vocab/franchises/` with example `powerpuff_girls.json`. Defines layered sourcing (manifest > heuristic co-occurrence > optional external adapters), strong vs weak signal tokens, ambiguity guards, and enrichment job endpoint concepts (`/franchises/{id}/enrich`, coverage). Rationale: automate population of character & alias vocab incrementally without bloating core token map or risking false positives; supports user action of adding new franchise then quickly seeding characters. No token_map_version bump (pure documentation / planning).
2025-08-16: Added optional Character `info_url` field and API inclusion to provide external reference link (e.g., wiki) without storing biographies/backstory locally; maintains minimal schema while enhancing user context discovery. No token_map_version bump.
2025-08-16: Added optional `rules_url` to Unit entity and exposed in proxy-candidates API response to allow quick navigation to official/public rules reference (pointer only, no rules text stored). Supports user desire for direct access to unit rules while keeping database minimal. No token_map_version bump.
2025-08-16: Seeded additional franchise manifests (`dc_comics`, `harry_potter`, `one_piece`, `one_punch_man`, `chainsaw_man`, `marvel`, `pokemon`, `berserk`, `legend_of_zelda`, `genshin_impact`, `honkai_multiverse`, `spy_x_family`, `scooby_doo`, `metal_gear_solid`, `alita_battle_angel`, `neon_genesis_evangelion`, `fate_series`, `diablo`) using minimal schema (franchise id, display_name, aliases, characters [canonical + aliases], tokens strong/weak/stop_conflicts + notes). Rationale: encountered corresponding character/franchise tokens in quick_scan unknown list; manifests enable early franchise detection while keeping core token map lean.
2025-08-16: Implemented ambiguous token handling for `lilith` across multiple franchises (e.g., Diablo vs other media) by classifying `lilith` as weak_signal in `diablo.json` and relying on co-occurrence with either franchise name (`diablo`) or distinctive Diablo-specific tokens (future additions: `sanctuary`, `tyrael`) for disambiguation. Avoids premature false positives in other contexts (generic demon/occult model names). No token_map_version bump (manifest-based enrichment only).
2025-08-16: Added extended franchise manifest batch seeded from new token leads: `kill_la_kill`, `sin_city`, `hunger_games`, `black_clover`, `teenage_mutant_ninja_turtles`, `lord_of_the_rings`, `bayonetta`, `king_of_fighters`, `bleach`, `skullgirls`, `dungeon_meshi`, `fullmetal_alchemist`, `naruto`, `seraph_of_the_end`, `high_school_dxd`, `resident_evil`, `danmachi`, `dragon_ball`, `blue_archive`, `bubblegum_crisis`, `addams_family`, `dune`, `lycoris_recoil`, `the_witcher`. Each uses minimal schema; applied cautious strong vs weak classification (e.g., month names, color adjectives, generic terms moved to weak or stop_conflicts). No token_map_version bump.
2025-08-16: Updated existing manifests: `marvel` (added rogue, spider_gwen, cassie_lang; weak tokens for gwen, stacy, cassie) and `neon_genesis_evangelion` (added compound token ayanami_rei) to reflect new franchise leads list. No token_map_version bump.
2025-08-16: Added second large enrichment batch & updates per new token leads and user selection (excluding optional Pokemon/Venom): New manifests created: `persona_series`, `gantz`, `mushoku_tensei`, `girls_frontline`, `rezero`, `vocaloid`, `shield_hero`, `spice_and_wolf`, `how_not_to_summon_a_demon_lord`, `cowboy_bebop`, `symphogear`, `fire_emblem`, `league_of_legends`. Updated existing: `honkai_multiverse` (added anby_demara), `lord_of_the_rings` (galadriel), `danmachi` (hestia), `naruto` (ino_yamanaka, hinata_hyuga; surname strong), `my_hero_academia` (himiko_toga), `bleach` (tier_harribel w/ spellings), `genshin_impact` (eula, fischl, hu_tao earlier). Strategy: strong signals favor distinctive surnames/qualified forms; ambiguous given names downgraded to weak; added qualifier tokens (e.g., *_rezero, gwen_lol, hilda_fire_emblem) to mitigate cross-franchise collisions. No token_map_version bump.
